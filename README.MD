# ğŸ“š BitLibro API

**BitLibro** es una aplicaciÃ³n Fullstack RESTful desarrollada en **.NET 8** con **SQL Server** que permite gestionar prÃ©stamos de libros mediante un sistema basado en roles: `Admin`, `Employee` y `Client`.

## ğŸš€ TecnologÃ­as utilizadas

- .NET 8
- Entity Framework Core (EF Core)
- SQL Server
- ASP.NET Core Identity
- JWT (JSON Web Tokens)
- FluentValidation
- Swagger (Swashbuckle)

## ğŸ“¦ Paquetes NuGet

```xml
<PackageReference Include="FluentValidation.AspNetCore" Version="11.3.1" />
<PackageReference Include="FluentValidation.DependencyInjectionExtensions" Version="12.0.0" />
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="8.0.17" />
<PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="8.0.17" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="9.0.6" />
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="9.0.6" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="9.0.6" />
<PackageReference Include="Swashbuckle.AspNetCore" Version="6.6.2" />
```

## ğŸ§‘â€ğŸ¤â€ğŸ§‘ Roles definidos

- Admin.
- Employee.
- Client.

## ğŸ” Base de datos

![MÃ³dulo Auth Swagger](capturas/BD.png)

## ğŸ” MÃ³dulo de AutenticaciÃ³n

Incluye los siguientes endpoints:

- `POST /api/auth/login`: Inicio de sesiÃ³n con validaciÃ³n usando FluentValidation.
- `POST /api/auth/logout`: Cierre de sesiÃ³n.
- `GET /api/auth/me`: ObtenciÃ³n de informaciÃ³n del usuario autenticado.

![MÃ³dulo Auth Swagger](capturas/DOCAUTH.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo Auth (/api/auth)

| MÃ©todo | Ruta               | DescripciÃ³n                       | Requiere JWT |
| ------ | ------------------ | --------------------------------- | ------------ |
| POST   | `/api/auth/login`  | Login de usuario                  | âŒ           |
| POST   | `/api/auth/logout` | Cerrar sesiÃ³n (invalida el token) | âœ…           |
| GET    | `/api/auth/me`     | Obtener datos del usuario actual  | âœ…           |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCAUTH.png)

## ğŸ‘» MÃ³dulo de GÃ©neros

Incluye los siguientes endpoints:

- `GET /api/genres`: Ver gÃ©neros (se puede filtar por Name y paginar con Page - PageSize ).
- `GET /api/genres/{id}`: Ver un gÃ©nero.
- `POST /api/genres`: Crear gÃ©nero con validaciÃ³n usando FluentValidation.
- `PUT /api/genres/{id}`: Editar gÃ©nero con validaciÃ³n usando FluentValidation.
- `DELETE /api/genres/{id}`: Eliminar gÃ©nero.

![MÃ³dulo Generos Swagger](capturas/DOCGENRE.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo GÃ©nero (/api/genres)

| MÃ©todo | Ruta               | DescripciÃ³n        | Requiere JWT | Admin | Employee |
| ------ | ------------------ | ------------------ | ------------ | ----- | -------- |
| GET    | `/api/genres/`     | Ver gÃ©neros        | âœ…           | âœ…    | âŒ       |
| GET    | `/api/genres/{id}` | Ver un gÃ©nero      | âœ…           | âœ…    | âŒ       |
| POST   | `/api/genres/`     | Crear gÃ©nero       | âœ…           | âœ…    | âŒ       |
| PUT    | `/api/genres/{id}` | Editar un gÃ©nero   | âœ…           | âœ…    | âŒ       |
| DELETE | `/api/genres/{id}` | Eliminar un gÃ©nero | âœ…           | âœ…    | âŒ       |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCGENRE.png)

## ğŸ“Œ MÃ³dulo de Empleados

Incluye los siguientes endpoints:

- `GET /api/employees`: Ver empleados (se puede filtar por Name, LastName y paginar con Page - PageSize ).
- `GET /api/employees/{id}`: Ver un empleado .
- `GET /api/employees/{id}/reservations`: Ver reservas realizadas por un empleado (se puede filtar por ClientName, Status y paginar con Page - PageSize ) .
- `POST /api/employees`: Crear empleado con validaciÃ³n usando FluentValidation.
- `PUT /api/employees/{id}`: Editar empleado con validaciÃ³n usando FluentValidation.
- `DELETE /api/employees/{id}`: Eliminar empleado.

![MÃ³dulo Generos Swagger](capturas/DOCEMPLOYEE.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo Empleado (/api/employees)

| MÃ©todo | Ruta                               | DescripciÃ³n                              | Requiere JWT | Admin | Employee |
| ------ | ---------------------------------- | ---------------------------------------- | ------------ | ----- | -------- |
| GET    | `/api/employees/`                  | Ver empleado                             | âœ…           | âœ…    | âŒ       |
| GET    | `/api/employees/{id}`              | Ver un empleado                          | âœ…           | âœ…    | âŒ       |
| GET    | `/api/employees/{id}/reservations` | Ver reservaciones hechas por un empleado | âœ…           | âœ…    | âŒ       |
| POST   | `/api/employees/`                  | Crear empleado                           | âœ…           | âœ…    | âŒ       |
| PUT    | `/api/employees/{id}`              | Editar un empleado                       | âœ…           | âœ…    | âŒ       |
| DELETE | `/api/employees/{id}`              | Eliminar un empleado                     | âœ…           | âœ…    | âŒ       |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCEMPLOYEE.png)

## ğŸ“Œ MÃ³dulo de Libros

Incluye los siguientes endpoints:

- `GET /api/books` - Listar libros (con filtros por Name, Author, ISBN, GenreId. Paginar con Page - PageSize por defecto de 10) --> (Admin, Employee)
- `GET /api/books/{id}` - Obtener libro por ID (Admin, Employee)
- `POST /api/books` - Crear libro (Admin)
- `PUT /api/books/{id}` - Actualizar libro (Admin) si se suben imÃ¡genes al editar, se eliminan las actuales y se intercambian por las nuevas
- `DELETE /api/books/{id}` - Eliminar libro (Admin)

**ImÃ¡genes**:

- `DELETE /api/books/{bookId}/images/{imageId}` - Eliminar imagen especÃ­fica (Admin)
- `DELETE /api/books/{bookId}/images` - Eliminar todas las imÃ¡genes de un libro (Admin)

![MÃ³dulo Generos Swagger](capturas/DOCBOOK.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo Libros (/api/books)

| MÃ©todo | Ruta                                   | DescripciÃ³n                             | Requiere JWT | Admin | Employee |
| ------ | -------------------------------------- | --------------------------------------- | ------------ | ----- | -------- |
| GET    | `/api/books/`                          | Ver libros                              | âœ…           | âœ…    | âœ…       |
| GET    | `/api/books/{id}`                      | Ver un libro                            | âœ…           | âœ…    | âœ…       |
| POST   | `/api/books/`                          | Crear libro                             | âœ…           | âœ…    | âŒ       |
| PUT    | `/api/books/{id}`                      | Editar un libro                         | âœ…           | âœ…    | âŒ       |
| DELETE | `/api/books/{id}`                      | Eliminar un libro                       | âœ…           | âœ…    | âŒ       |
| DELETE | `/api/books/{bookId}/images/{imageId}` | Eliminar imagen especÃ­fica              | âœ…           | âœ…    | âŒ       |
| DELETE | `/api/books/{bookId}/images`           | Eliminar todas las imÃ¡genes de un libro | âœ…           | âœ…    | âŒ       |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCBOOK.png)

## ğŸ“Œ MÃ³dulo de PrÃ©stamos

Incluye los siguientes endpoints:

- `GET /api/reservations` - Listar reservaciones (con filtros por ClientName, EmployeeName, Status. Paginar con Page - PageSize por defecto de 10) si soy admin se muestran todas las reservaciones, en caso de ser empleado se muestran solo las reservaciones que he realizado --> (Admin, Employee)
- `GET /api/reservations/{id}` - Obtener reservaciÃ³n por ID (Admin y Employee) en el caso de Employee es siempre y cuando la reservaciÃ³n la haya hecho el Employee ---> (Admin, Employee)
- `POST /api/reservations` - Crear ReservaciÃ³n (Employee)
- `PUT /api/reservations/{id}` - Actualizar reservaciÃ³n (Admin y Employee)

![MÃ³dulo Generos Swagger](capturas/DOCRESERVATION.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo PrÃ©stamos (/api/reservations)

| MÃ©todo | Ruta                     | DescripciÃ³n            | Requiere JWT | Admin | Employee |
| ------ | ------------------------ | ---------------------- | ------------ | ----- | -------- |
| GET    | `/api/reservations/`     | Listar reservaciones   | âœ…           | âœ…    | âœ…       |
| GET    | `/api/reservations/{id}` | Ver una reservaciÃ³n    | âœ…           | âœ…    | âœ…       |
| POST   | `/api/reservations/`     | Crear reservaciÃ³n      | âœ…           | âŒ    | âœ…       |
| PUT    | `/api/reservations/{id}` | Editar una reservaciÃ³n | âœ…           | âœ…    | âœ…       |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCRESERVATION.png)

## ğŸ‘¥ MÃ³dulo de Clientes

Incluye los siguientes endpoints:

- `GET /api/clients` - Listar clientes (con filtros por EmployeeName, Status. Paginar con Page - PageSize por defecto de 10) --> (Admin, Employee)
- `GET /api/clients/{id}` - Obtener cliente por ID (Admin)
- `GET /api/clients/{id}/reservations` - Obtener todas las reservaciones de un cliente por ID (con filtros por EmployeeName, Status. Paginar con Page - PageSize por defecto de 10) --> (Admin)

![MÃ³dulo Generos Swagger](capturas/DOCCLIENTS.png)

### ğŸ” Endpoints principales

### ğŸ“Œ MÃ³dulo Clientes (/api/clients)

| MÃ©todo | Ruta                             | DescripciÃ³n                     | Requiere JWT | Admin | Employee |
| ------ | -------------------------------- | ------------------------------- | ------------ | ----- | -------- |
| GET    | `/api/clients/`                  | Listar clientes                 | âœ…           | âœ…    | âœ…       |
| GET    | `/api/clients/{id}`              | Ver un cliente                  | âœ…           | âœ…    | âŒ       |
| POST   | `/api/clients/{id}/reservations` | Ver reservaciones de un cliente | âœ…           | âœ…    | âŒ       |

### Digrama de caso de uso

![MÃ³dulo Auth Diagrama de casos de uso](capturas/DCCLIENTS.png)

## âœ… Pruebas Manuales y AutomÃ¡ticas Realizadas

### ğŸ” MÃ³dulo de AutenticaciÃ³n

`POST /api/auth/login`

- [âœ”ï¸] Errores de validaciÃ³n (campos requeridos vacÃ­os)
- [âœ”ï¸] Credenciales invÃ¡lidas (email o contraseÃ±a incorrecta)
- [âœ”ï¸] Login exitoso con token JWT retornado

`POST /api/auth/logout`

- [âœ”ï¸] Logout exitoso (token invalidado)
- [âœ”ï¸] Acceso no autenticado (401)

`GET /api/auth/me`

- [âœ”ï¸] Usuario autenticado recibe su informaciÃ³n correctamente
- [âœ”ï¸] Usuario no autenticado recibe error 401

### ğŸ§© MÃ³dulo de GÃ©neros

`GET /api/genres/{id}`

- [âœ”ï¸] GÃ©nero encontrado exitosamente

- [âœ”ï¸] GÃ©nero no encontrado (404)

`POST /api/genres`

- [âœ”ï¸] GÃ©nero ya existente (409 o validaciÃ³n fallida)

- [âœ”ï¸] Errores de validaciÃ³n (nombre vacÃ­o o muy corto)

- [âœ”ï¸] CreaciÃ³n exitosa

`PUT /api/genres/{id}`

- [âœ”ï¸] GÃ©nero ya en uso (conflicto)

- [âœ”ï¸] Errores de validaciÃ³n

- [âœ”ï¸] ActualizaciÃ³n exitosa

`DELETE /api/genres/{id}`

- [âœ”ï¸] Eliminado exitosamente

- [âœ”ï¸] GÃ©nero no encontrado (404)

### ğŸ‘¥ MÃ³dulo de Empleados

`GET /api/employees/{id}`

- [âœ”ï¸] Empleado existente retornado correctamente

- [âœ”ï¸] Empleado no encontrado

`GET /api/employees/{id}/reservations`

- [âœ”ï¸] Empleado existente retornado correctamente paginados filtros

- [âœ”ï¸] Empleado no encontrado

`POST /api/employees`

- [âœ”ï¸] CI ya en uso

- [âœ”ï¸] Email ya en uso

- [âœ”ï¸] Errores de validaciÃ³n (nombre vacÃ­o, email invÃ¡lido, etc.)

- [âœ”ï¸] CreaciÃ³n exitosa

`PUT /api/employees/{id}`

- [âœ”ï¸] Errores de validaciÃ³n

- [âœ”ï¸] CI ya en uso

- [âœ”ï¸] ActualizaciÃ³n exitosa

`DELETE /api/employees/{id}`

- [âœ”ï¸] Eliminado exitosamente

- [âœ”ï¸] No encontrado (404)

### ğŸ“š MÃ³dulo de Libros

`GET /api/books/{id}`

- [âœ”ï¸] Libro encontrado

- [âœ”ï¸] Libro no existente

`POST /api/books`

- [âœ”ï¸] Nombre ya ocupado

- [âœ”ï¸] ISBN ya en uso

- [âœ”ï¸] GÃ©nero no existe

- [âœ”ï¸] Errores de validaciÃ³n

- [âœ”ï¸] CreaciÃ³n exitosa

`PUT /api/books/{id}`

- [âœ”ï¸] Reemplazo de imÃ¡genes al actualizar

- [âœ”ï¸] Nombre o ISBN ya en uso

- [âœ”ï¸] GÃ©nero no existe

- [âœ”ï¸] Errores de validaciÃ³n

- [âœ”ï¸] ActualizaciÃ³n exitosa

`DELETE /api/books/{id}`

- [âœ”ï¸] EliminaciÃ³n exitosa

- [âœ”ï¸] Libro inexistente

### ğŸ“† MÃ³dulo de Reservaciones

`GET /api/reservations/{id}`

- [âœ”ï¸] ReservaciÃ³n no encontrada

- [âœ”ï¸] Acceso exitoso para Admin o Employee asignado

`POST /api/reservations`

- [âœ”ï¸] CI del cliente ya registrado

- [âœ”ï¸] Libro no existe

- [âœ”ï¸] Libro ya reservado en ese rango de fechas

- [âœ”ï¸] Validaciones fallidas

- [âœ”ï¸] ReservaciÃ³n exitosa

`PUT /api/reservations/{id}`

- [âœ”ï¸] ActualizaciÃ³n exitosa por Admin o Employee

- [âœ”ï¸] Validaciones fallidas

### ğŸ‘¥ MÃ³dulo de Clientes

`GET /api/clients/{id}`

- [âœ”ï¸] Cliente no encontrado

- [âœ”ï¸] Acceso exitoso paginado filtrado

`GET /api/clients/{id}/reservations`

- [âœ”ï¸] Cliente no encontrado

- [âœ”ï¸] Acceso exitoso paginado filtrado

## ğŸ“¦ InstalaciÃ³n y configuraciÃ³n

1. **Clona el repositorio:**

```bash
git clone https://github.com/JeanDev-10/APP-BITLIBRO.git
cd APP-BITLIBRO/API/API-BITLIBRO
```

2. **Configura _appsettings.json_:**
   Debes agregar las claves JWT, conexiÃ³n a base de datos y los orÃ­gines permitidos:

```json
"ConnectionStrings": {
    "DefaultConnection": "Your-default-connection"
  },
  "JWTSettings":{
    "SecretKey":"your-256-bit-secret",
    "Audience":"https://localhost:4200",
    "Issuer":"https://localhost:5188",
    "TokenExpirationInMinutes": 60
  },
  "AllowedOrigins":[
    "http://localhost:4200"
  ]
```

3. **Instala dependecias y construye**

```bash
dotnet restore
dotnet build
```

4. **Ejecuta las migraciones:**

```bash
dotnet ef database update
```

5. **Ejecuta el proyecto:**

```bash
dotnet run
```

---

Acceder a la documentaciÃ³n:
Abrir en navegador: http://localhost:5188/swagger

---

## Autor

- [Jean Pierre RodrÃ­guez Zambrano](https://github.com/JeanDev-10)

---
